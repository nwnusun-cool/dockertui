## 项目概述

这是一个面向 **Docker 生态** 的终端 TUI 工具，灵感来源于 k9s，目标是为开发 / 运维工程师提供一个统一的、键盘驱动的 Docker 控制台。  
它将整合单机 Docker、本地 docker-compose 环境的管理能力，提供高效的容器/服务查看、日志与操作体验，而不仅仅是“容器列表浏览器”。

工具希望覆盖如下典型场景：

- **本地开发**：一眼看清本地所有容器 / compose 项目状态，快捷查看日志、进入容器、重启服务。  
- **单机运维**：在一台开发/测试机器上集中管理多个容器和本地服务，方便排查问题与调试。  
- **docker-compose 管理**：统一发现、管理和操作多个 compose 项目。

---

## 核心要求

- **统一入口、统一视图**
  - **要求**：通过一个终端 TUI，统一管理本地 Docker、本地 docker-compose 项目中的容器与镜像。
  - **目标**：减少频繁切换 `docker` CLI、docker-compose 命令、多个终端窗口等操作。

- **键盘优先、高效率操作**
  - **要求**：核心操作必须可通过键盘快捷键完成，尽量减少输入长命令。
  - **目标**：熟练用户可像使用 k9s 一样，快速浏览和操作各类资源。

- **面向本地开发与日常运维场景**
  - **要求**：围绕本地容器/服务的常见操作（查看状态、看日志、重启、进入容器等）优化交互，而不是仅仅罗列资源。
  - **目标**：让开发/运维在本机调试和排查问题时更高效、少敲命令。

- **简洁部署、零侵入**
  - **要求**：单二进制或简单安装方式，无需复杂服务端部署；尽量避免强制要求额外组件。
  - **目标**：个人开发者与小团队可快速落地使用。

---

## 核心功能

### 1. 资源视图（类似 k9s，但面向 Docker）

- **容器视图**
  - 列表显示本地 Docker 中的容器（支持按项目 / compose 分组）。
  - 显示：状态、名称、镜像、创建时间、CPU/Mem 使用率、重启次数。
  - 支持操作：启动 / 停止 / 重启 / 删除 / 清理退出容器。
  - 快捷进入容器 shell（`docker exec -it` 封装）。
  - 快捷查看 / 跟随日志（`tail -f` 风格）。

- **镜像视图**
  - 列表显示本地镜像（按项目 / 标签过滤）。
  - 显示：镜像名、标签、大小、创建时间、使用情况（被哪些容器使用）。
  - 支持操作：删除镜像、标记为保留、清理未使用镜像（dangling / unused）。

- **网络视图**
  - 列出 Docker 网络。
  - 查看网络详情：驱动类型、关联容器、子网等。
  - 支持创建 / 删除网络（后期可加）。

- **Volume 视图**
  - 列表 Volume，显示大小、挂载点、关联容器。
  - 支持删除未使用 Volume。

- **Host / 环境视图（预留未来扩展）**
  - 当前版本仅用于展示本机 Docker 运行时的一些基础信息，未来可扩展为更多环境视图。

### 2. docker-compose 专用支持

- **Compose 项目扫描**
  - 自动扫描当前目录及子目录中的 `docker-compose.yml` / `docker-compose.*.yml` 文件。
  - 将其识别为“项目”，列表展示。

- **Compose 项目操作**
  - 对单个项目：一键 `up` / `down` / `restart` / `logs`。
  - 查看 compose 中所有服务的状态、端口、依赖关系。
  - 一键查看当前项目的整体健康状态（所有服务是否运行、日志是否有错误）。

- **本地开发友好能力**
  - 支持为每个项目定义“开发模式配置”（比如附加环境变量、额外 volume，用于本地调试）。
  - 支持一键清理由该项目创建的容器、网络、volume。

### 3. 未来扩展：多主机 / 多环境管理（本期不实现，仅保留方向）

- 后续版本可以考虑：
  - 通过配置文件管理多台 Docker 宿主机；
  - 在容器视图中按主机 / 环境聚合展示；
  - 提供安全可控的跨主机批量操作能力。

### 4. 未来扩展：运维任务 / 工作流（Playbook）（本期不实现）

- 当前版本仅聚焦本地 Docker / docker-compose 容器的查看与操作，不提供 Playbook 引擎。
- 未来可在本地信息完备的基础上，考虑引入简单的“排障脚本/任务流”作为增强功能。

### 5. 日志与监控整合（轻量版本）

- **日志整合**
  - 从 Docker 容器中拉取日志，支持：
    - 关键字过滤；
    - 按时间窗口查看；
    - 多容器合并视图（同一服务实例的多容器日志并排）。

- **基本监控视图**
  - 通过 Docker stats 或轻量采集方式展示容器 CPU/Mem/网络 IO。
  - 宿主机级别资源使用（结合系统命令/远程代理）。

- **外部监控系统对接（可选，后期）**
  - 提供插件接口，对接 Prometheus / Loki / ELK 等，以在 TUI 内展示关键指标 / 日志摘要。

### 6. 快捷操作 & 自定义命令

- **快捷键体系**
  - 类似 k9s：`j/k` 上下移动，`Enter` 进入详情，`l` 看日志，`s` 进入 shell，`r` 重启，`d` 删除等。
  - 全局命令面板（如 `:` 开头）：输入关键字即筛选可执行操作。

- **自定义命令模板**
  - 用户可为某类对象（容器 / 镜像）配置自定义命令，如：
    - “清理缓存脚本”；
    - “抓取诊断信息并打包”；
  - 在 TUI 中选中对象后，一键执行这些自定义命令。

---

## 核心组件

- **CLI 启动器**
  - 负责解析命令行参数（配置路径、目标主机、模式等）。
  - 启动 TUI 主循环。

- **TUI UI 层**
  - 负责界面渲染和键盘事件处理：
    - 列表视图（容器、镜像、网络、volume、host、compose 项目等）。
    - 详情视图（容器详情、日志视图、简单监控视图等）。
  - 封装为可扩展的视图模块，方便后续增加新视图。

- **Docker 客户端层**
  - 封装对 Docker Engine HTTP API 的访问：
    - 支持本地 socket / 远程 TCP / SSH 代理。
  - 提供统一接口：列出容器/镜像、stats、日志、exec、compose 相关调用（可以通过 docker CLI 或 SDK）。

- **Host / 环境管理模块**
  - 维护所有主机配置（地址、认证信息、标签等）。
  - 负责连接复用、健康检查。

- **配置与存储模块**
  - 负责加载 / 保存：
    - 本地 docker-compose 项目信息；
    - 自定义命令模板；
    - 用户偏好（主题、快捷键映射等）。
  - 本地持久化可采用简单文件格式（YAML/JSON）

- **日志与监控整合模块**
  - 封装容器日志获取和基础监控数据采集。
  - 后期作为插件扩展接口对接外部监控系统。

---

### 模块边界与层次架构

下面是当前 MVP 版本的简化模块架构图（仅针对本地 Docker + 本地 docker-compose 场景）：

```text
+---------------------------+
|       cmd/docktui        |
| - 解析参数/加载配置      |
| - 构造依赖并启动 TUI    |
+-------------+-------------+
              |
              v
+---------------------------+
|       internal/ui         |
| - TUI 视图与状态管理     |
| - 仅依赖抽象接口         |
+-------------+-------------+
              |
              v
+---------------------------+
|       internal/docker     |
| - 封装 Docker SDK        |
| - 暴露 Client 接口       |
+-------------+-------------+
              |
              v
+---------------------------+
| internal/config           |
| （未来）internal/compose |
+---------------------------+
```

模块职责与允许的依赖关系：

- **cmd/docktui**：应用入口，负责加载配置（`internal/config`）、初始化 Docker 客户端（`internal/docker`），构造 UI Model（`internal/ui`），然后启动 Bubble Tea 程序；不直接包含业务逻辑。
- **internal/ui**：TUI 层，负责界面渲染、键盘事件处理和视图/状态管理；只依赖抽象的 Docker 接口（`docker.Client`）以及未来的 compose 封装接口，不直接操作 Docker SDK 或 `os/exec`。
- **internal/docker**：Docker 客户端层，封装对 Docker Engine 的访问细节，对外仅暴露 `Client` 接口；可以依赖 `internal/config` 获取连接配置，但不反向依赖 UI。
- **internal/config**：配置模块，负责从环境变量/配置文件加载运行所需配置（如 Docker Host、超时等），供 `cmd/docktui` 和 `internal/docker` 使用；其他模块不直接读取环境变量。
- **（预留）internal/compose**：未来用于通过 `docker compose`/`docker-compose` CLI 管理本地 compose 项目，对外仅暴露高层接口（如“列出项目”“执行 up/down/logs”），内部可复用 `internal/config` 和 `internal/docker`，但 UI 依然只通过该模块的接口交互。

依赖方向总结：

- 允许：`cmd/docktui → internal/config`、`cmd/docktui → internal/docker`、`cmd/docktui → internal/ui`。
- 允许：`internal/ui → internal/docker(通过接口)`、`internal/ui → internal/compose(通过接口)`。
- 允许：`internal/docker → internal/config`、`internal/compose → internal/config`、`internal/compose → internal/docker(通过接口)`。
- 禁止：任何模块依赖方向“自下而上”（如 `internal/docker` 依赖 UI）或跨层直接绕过接口（如 UI 直接依赖 Docker SDK 或 shell 命令）。

---

## 应用 / 用户流程

### 流程1：本地开发者管理本地 Docker 和 compose

- **步骤**：
  - 启动 TUI 工具（例如 `docktui`）。
  - 首页显示本地主机概览 + 探测到的 compose 项目。
  - 用户使用快捷键切换到 “Compose 项目视图”，选择一个项目：
    - 一键 `up` 启动项目所有服务；
    - 切换到容器视图查看各服务状态；  
    - 选中某个容器，查看日志 / 进入 shell。
  - 结束开发时：
    - 回到 compose 项目，执行 `down`；
    - 再通过清理命令清除未使用容器 / volume。


### 流程2：管理多个 docker-compose 环境

- **步骤**：
  - 在项目根目录启动 TUI。
  - 工具自动扫描发现多个 compose 项：`dev`、`test`、`mock-prod` 等。
  - 用户切换到某项目：
    - 查看所有服务的状态及映射端口；
    - 一键切换不同配置（例如不同 `.env` 文件）。
  - 对某个项目执行“本地环境重置”：
    - 停止所有容器；
    - 删除相关容器、网络、Volume；
    - 重新 `up`。

---

## 技术栈

- **语言**
  - **Go** 作为首选：
    - 生态中已有成熟的 TUI 库（如 Bubble Tea、tcell 等）；
    - 有成熟的 Docker SDK / client 库；
    - 编译为单一二进制，易于分发。

- **TUI 框架**
  - 可选：  
    - **Bubble Tea**（更偏声明式、易组织复杂 UI）；  
    - 或基于 **tcell** 自己封装 UI 层（控制更灵活但开发成本略高）。
  - 初版建议选择 Bubble Tea + 辅助组件（如 lipgloss, bubbles）。

- **Docker 接口**
  - 使用 Docker Engine HTTP API / Go SDK：
    - 支持本地 Unix socket / Windows named pipe；
    - 对于 docker-compose，可以：
      - 前期通过调用 `docker compose`/`docker-compose` 命令接管（解析输出）；
      - 后期考虑更深层集成。

- **配置与存储**
  - 配置文件：YAML（项目列表、自定义命令、Playbook 等）。
  - 本地轻量数据库：BoltDB 或 SQLite，存储缓存数据（如本地项目元数据、历史选择、Playbook 执行记录）。

- **打包与发布**
  - 编译为跨平台二进制：Linux / macOS / Windows。
  - 通过 Homebrew、Scoop、手动下载等方式发布。

---